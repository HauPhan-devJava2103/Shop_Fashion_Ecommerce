<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/main}">
  <head>
    <title>Đặt hàng thành công</title>
  </head>
  <body>
    <main layout:fragment="content">
      <section class="shop_grid_area section-padding-80">
        <div class="container">
          <div class="row justify-content-center">
            <div class="col-12 col-lg-8">
              <div class="bg-white rounded p-4" style="border: 1px solid #eee;">
                <h4 class="mb-2">Đặt hàng thành công</h4>
                <p class="text-muted mb-4">Cảm ơn bạn. Đơn hàng đã được tạo và đang chờ xác nhận.</p>

                <div class="p-3 rounded" style="background: #fafafa; border: 1px dashed #e5e5e5;">
                  <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Mã đơn</span>
                    <span class="fw-semibold" th:text="${order != null ? order.id : ''}">0</span>
                  </div>
                  <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Trạng thái</span>
                    <span class="fw-semibold" th:text="${order != null ? order.orderStatus.displayName : ''}">Chờ xác nhận</span>
                  </div>
                  <div class="d-flex justify-content-between mb-2">
                    <span class="text-muted">Thanh toán</span>
                    <span class="fw-semibold" th:text="${order != null ? order.paymentMethod.displayName : ''}">COD</span>
                  </div>
                  <div class="d-flex justify-content-between">
                    <span class="text-muted">Tổng tiền</span>
                    <span class="fw-semibold" th:text="${order != null ? (#numbers.formatDecimal(order.totalAmount, 0, 'COMMA', 0, 'POINT') + 'đ') : '0đ'}">0đ</span>
                  </div>

                  <div th:if="${order != null and order.discountAmount != null and order.discountAmount > 0}" class="d-flex justify-content-between mt-2">
                    <span class="text-muted">Giảm giá</span>
                    <span class="fw-semibold" th:text="'-' + ${#numbers.formatDecimal(order.discountAmount, 0, 'COMMA', 0, 'POINT')} + 'đ'">-0đ</span>
                  </div>

                  <div th:if="${order != null and order.voucherCode != null}" class="d-flex justify-content-between mt-2">
                    <span class="text-muted">Voucher</span>
                    <span class="fw-semibold" th:text="${order.voucherCode}">CODE</span>
                  </div>
                </div>

                <div th:if="${order != null and order.orderAddress != null}" class="mt-4">
                  <h6 class="mb-2">Thông tin giao hàng</h6>
                  <div class="text-muted" th:text="${order.orderAddress.recipientName}">Tên</div>
                  <div class="text-muted" th:text="${order.orderAddress.phone}">SĐT</div>
                  <div class="text-muted" th:text="${order.orderAddress.addressLine}">Địa chỉ</div>
                  <div class="text-muted" th:text="${(order.orderAddress.ward != null ? order.orderAddress.ward + ', ' : '') + (order.orderAddress.district != null ? order.orderAddress.district + ', ' : '') + (order.orderAddress.city != null ? order.orderAddress.city : '')}"></div>
                </div>

                <div th:if="${order != null and order.orderItems != null and !order.orderItems.isEmpty()}" class="mt-4">
                  <h6 class="mb-2">Sản phẩm</h6>
                  <div th:each="oi : ${order.orderItems}" class="d-flex justify-content-between py-2" style="border-bottom: 1px dashed #eee;">
                    <div style="max-width: 75%;">
                      <div class="fw-semibold" th:text="${oi.variant != null && oi.variant.product != null ? oi.variant.product.productName : ''}">Product</div>
                      <div class="text-muted" style="font-size: 13px;" th:text="${(oi.variant != null && oi.variant.color != null ? 'Màu: ' + oi.variant.color : '') + (oi.variant != null && oi.variant.size != null ? ' | Size: ' + oi.variant.size : '')}"></div>
                      <div class="text-muted" style="font-size: 13px;" th:text="'SL: ' + ${oi.quantity} + ' x ' + ${#numbers.formatDecimal(oi.unitPrice, 0, 'COMMA', 0, 'POINT')} + 'đ'"></div>
                    </div>
                    <div class="fw-semibold" th:text="${#numbers.formatDecimal(oi.totalPrice, 0, 'COMMA', 0, 'POINT')} + 'đ'">0đ</div>
                  </div>
                </div>

                <div class="mt-4 d-flex gap-2">
                  <a th:href="@{/orders/{id}(id=${order.id})}" class="btn essence-btn">Xem trạng thái đơn</a>
                  <a th:href="@{/orders}" class="btn btn-outline-dark">Đơn hàng của tôi</a>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </body>
</html>
