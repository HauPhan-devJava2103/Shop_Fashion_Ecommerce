<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/admin}">
  <head>
    <title>Sản phẩm - ADMIN</title>
  </head>
  <body>
    <main layout:fragment="content">
      <div class="d-flex align-items-center justify-content-between mb-3">
        <h4 class="mb-0">Quản lý sản phẩm</h4>
        <a class="btn btn-primary" th:href="@{/admin/products/create}">
          <i class="bi bi-plus-circle me-1"></i> Thêm sản phẩm
        </a>
      </div>

      <div th:if="${successMessage}" class="alert alert-success" th:text="${successMessage}"></div>
      <div th:if="${errorMessage}" class="alert alert-danger" th:text="${errorMessage}"></div>

      <form class="row g-2 mb-3" method="get" th:action="@{/admin/products}">
        <div class="col-12 col-md-4">
          <input class="form-control" type="text" name="keyword" placeholder="Tìm theo tên/SKU" th:value="${keyword}" />
        </div>
        <div class="col-12 col-md-3">
          <select class="form-select" name="categoryId">
            <option value="" th:selected="${categoryId == null}">Tất cả danh mục</option>
            <option th:each="c : ${categories}" th:value="${c.id}" th:text="${c.categoryName}" th:selected="${categoryId != null and c.id == categoryId}"></option>
          </select>
        </div>
        <div class="col-12 col-md-3">
          <select class="form-select" name="status">
            <option value="" th:selected="${status == null or status == ''}">Tất cả trạng thái</option>
            <option value="active" th:selected="${status != null and status.equalsIgnoreCase('active')}">Đang bán</option>
            <option value="inactive" th:selected="${status != null and status.equalsIgnoreCase('inactive')}">Đã ẩn</option>
          </select>
        </div>
        <div class="col-12 col-md-2 d-grid">
          <button class="btn btn-outline-secondary" type="submit">
            <i class="bi bi-search me-1"></i>Lọc
          </button>
        </div>
      </form>

      <div class="card shadow-sm">
        <div class="table-responsive">
          <table class="table table-striped align-middle mb-0">
            <thead class="table-light">
              <tr>
                <th style="width: 90px">Ảnh</th>
                <th>SKU</th>
                <th>Tên</th>
                <th>Danh mục</th>
                <th class="text-end">Giá</th>
                <th class="text-end">Giảm (%)</th>
                <th class="text-end">Tồn</th>
                <th>Trạng thái</th>
                <th style="width: 170px">Thao tác</th>
              </tr>
            </thead>
            <tbody>
              <tr th:each="p : ${products.content}">
                <td>
                  <img
                    th:src="${(p.images != null and !p.images.isEmpty()) ? p.images.get(0).urlImage : '/img/core-img/favicon.ico'}"
                    alt=""
                    style="width: 64px; height: 64px; object-fit: cover"
                    class="rounded border" />
                </td>
                <td th:text="${p.sku}"></td>
                <td th:text="${p.productName}"></td>
                <td th:text="${p.category != null ? p.category.categoryName : '-'}"></td>
                <td class="text-end" th:text="${#numbers.formatDecimal(p.price, 0, 'COMMA', 0, 'POINT')}"></td>
                <td class="text-end" th:text="${p.discount}"></td>
                <td class="text-end" th:text="${p.stock}"></td>
                <td>
                  <span
                    class="badge"
                    th:classappend="${p.isActive} ? ' text-bg-success' : ' text-bg-secondary'"
                    th:text="${p.isActive} ? 'Đang bán' : 'Đã ẩn'"></span>
                </td>
                <td>
                  <a class="btn btn-sm btn-outline-primary" th:href="@{/admin/products/edit/{id}(id=${p.id})}">
                    Sửa
                  </a>
                  <a
                    class="btn btn-sm btn-outline-danger"
                    th:href="@{/admin/products/delete/{id}(id=${p.id})}"
                    onclick="return confirm('Ẩn sản phẩm này?')">
                    Ẩn
                  </a>
                </td>
              </tr>
              <tr th:if="${products.totalElements == 0}">
                <td colspan="9" class="text-center text-muted py-4">Không có sản phẩm</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <nav class="mt-3" th:if="${totalPages > 1}">
        <ul class="pagination">
          <li class="page-item" th:classappend="${currentPage == 1} ? ' disabled'">
            <a
              class="page-link"
              th:href="@{/admin/products(page=${currentPage-1}, keyword=${keyword}, categoryId=${categoryId}, status=${status})}">
              Trước
            </a>
          </li>
          <li
            class="page-item"
            th:each="i : ${#numbers.sequence(1, totalPages)}"
            th:classappend="${i == currentPage} ? ' active'">
            <a
              class="page-link"
              th:href="@{/admin/products(page=${i}, keyword=${keyword}, categoryId=${categoryId}, status=${status})}"
              th:text="${i}"></a>
          </li>
          <li class="page-item" th:classappend="${currentPage == totalPages} ? ' disabled'">
            <a
              class="page-link"
              th:href="@{/admin/products(page=${currentPage+1}, keyword=${keyword}, categoryId=${categoryId}, status=${status})}">
              Sau
            </a>
          </li>
        </ul>
      </nav>
    </main>
  </body>
</html>
