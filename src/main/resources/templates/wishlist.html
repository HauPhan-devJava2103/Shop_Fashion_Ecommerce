<!DOCTYPE html>
<html
  xmlns:th="http://www.thymeleaf.org"
  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
  layout:decorate="~{layout/main}">
  <head>
    <title th:text="${pageTitle != null ? pageTitle : 'Wishlist'}">
      Wishlist
    </title>
    <style>
      /* Override default strikethrough on price */
      .single-product-wrapper .product-description p.product-price span {
        text-decoration: none !important;
        color: #000000 !important;
      }

      /* Fix product image height for consistent display */
      .single-product-wrapper .product-img {
        aspect-ratio: 4 / 5;
        overflow: hidden;
        display: flex;
        align-items: center;
        justify-content: center;
        background-color: #f8f9fa;
      }
      .single-product-wrapper .product-img img {
        width: 100%;
        height: 100%;
        object-fit: cover;
        transition: transform 0.3s ease;
      }
      .single-product-wrapper:hover .product-img img {
        transform: scale(1.05);
      }
    </style>
  </head>
  <body>
    <main layout:fragment="content">
      <section
        class="breadcrumb-area bg-img bg-overlay"
        th:style="'background-image: url(' + @{/img/bg-img/breadcumb.jpg} + ');'">
        <div class="container h-100">
          <div class="row h-100 align-items-center">
            <div class="col-12">
              <div class="breadcrumb-content text-center">
                <h2>Wishlist</h2>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="shop_grid_area section-padding-80">
        <div class="container">
          <!-- Guest mode notice -->
          <div th:if="${guestMode}" class="alert alert-info mb-4">
            <i class="fa fa-info-circle me-2"></i>
            Bạn đang xem wishlist tạm thời.
            <a th:href="@{/login}" class="alert-link">Đăng nhập</a> để lưu
            wishlist vĩnh viễn.
          </div>

          <!-- Empty state for authenticated users -->
          <div
            class="row"
            th:if="${!guestMode and (items == null or #lists.isEmpty(items))}">
            <div class="col-12">
              <div class="bg-white rounded p-4" style="border: 1px solid #eee">
                <h5 class="mb-2">Wishlist trống</h5>
                <p class="text-muted mb-3">
                  Bạn chưa thêm sản phẩm nào vào wishlist.
                </p>
                <a th:href="@{/shop}" class="btn btn-outline-dark"
                  >Tiếp tục mua sắm</a
                >
              </div>
            </div>
          </div>

          <!-- Empty state for guest users -->
          <div
            class="row"
            th:if="${guestMode and (products == null or #lists.isEmpty(products))}">
            <div class="col-12">
              <div class="bg-white rounded p-4" style="border: 1px solid #eee">
                <h5 class="mb-2">Wishlist trống</h5>
                <p class="text-muted mb-3">
                  Bạn chưa thêm sản phẩm nào vào wishlist.
                </p>
                <a th:href="@{/shop}" class="btn btn-outline-dark"
                  >Tiếp tục mua sắm</a
                >
              </div>
            </div>
          </div>

          <!-- Authenticated user wishlist (from DB) -->
          <div
            class="row"
            th:if="${!guestMode and items != null and !#lists.isEmpty(items)}">
            <div
              class="col-12 col-sm-6 col-lg-4"
              th:each="wi : ${items}"
              data-wishlist-item>
              <div class="single-product-wrapper">
                <div class="product-img">
                  <a th:href="@{/product/{id}(id=${wi.product.id})}">
                    <img
                      th:if="${wi.product.mainImageUrl != null and !#strings.isEmpty(wi.product.mainImageUrl)}"
                      th:src="${wi.product.mainImageUrl}"
                      th:alt="${wi.product.productName}" />
                    <img
                      th:unless="${wi.product.mainImageUrl != null and !#strings.isEmpty(wi.product.mainImageUrl)}"
                      th:src="@{/img/product-img/product-1.jpg}"
                      th:alt="${wi.product.productName}" />
                  </a>
                </div>

                <div class="product-description">
                  <a th:href="@{/product/{id}(id=${wi.product.id})}">
                    <h6 th:text="${wi.product.productName}">Product Name</h6>
                  </a>

                  <p class="product-price">
                    <span
                      th:text="${#numbers.formatDecimal(wi.product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"
                      >0đ</span
                    >
                  </p>

                  <div class="hover-content">
                    <div class="add-to-cart-btn d-flex flex-column gap-2">
                      <a
                        th:href="@{/product/{id}(id=${wi.product.id})}"
                        class="btn essence-btn w-100"
                        >Xem chi tiết</a
                      >
                      <a
                        th:href="@{/wishlist/toggle(productId=${wi.product.id})}"
                        class="btn btn-outline-danger w-100 js-wishlist-toggle"
                        th:attr="data-product-id=${wi.product.id}, data-product-name=${wi.product.productName}"
                        data-remove-on-unlike>
                        <i class="fa fa-heart-broken me-1"></i> Bỏ thích
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Guest wishlist (from cookie) -->
          <div
            class="row"
            th:if="${guestMode and products != null and !#lists.isEmpty(products)}">
            <div
              class="col-12 col-sm-6 col-lg-4"
              th:each="product : ${products}"
              data-wishlist-item>
              <div class="single-product-wrapper">
                <div class="product-img">
                  <a th:href="@{/product/{id}(id=${product.id})}">
                    <img
                      th:if="${product.mainImageUrl != null and !#strings.isEmpty(product.mainImageUrl)}"
                      th:src="${product.mainImageUrl}"
                      th:alt="${product.productName}" />
                    <img
                      th:unless="${product.mainImageUrl != null and !#strings.isEmpty(product.mainImageUrl)}"
                      th:src="@{/img/product-img/product-1.jpg}"
                      th:alt="${product.productName}" />
                  </a>
                </div>

                <div class="product-description">
                  <a th:href="@{/product/{id}(id=${product.id})}">
                    <h6 th:text="${product.productName}">Product Name</h6>
                  </a>

                  <p class="product-price">
                    <span
                      th:text="${#numbers.formatDecimal(product.price, 0, 'COMMA', 0, 'POINT')} + 'đ'"
                      >0đ</span
                    >
                  </p>

                  <div class="hover-content">
                    <div class="add-to-cart-btn d-flex flex-column gap-2">
                      <a
                        th:href="@{/product/{id}(id=${product.id})}"
                        class="btn essence-btn w-100"
                        >Xem chi tiết</a
                      >
                      <a
                        th:href="@{/wishlist/toggle(productId=${product.id})}"
                        class="btn btn-outline-danger w-100 js-wishlist-toggle"
                        th:attr="data-product-id=${product.id}, data-product-name=${product.productName}"
                        data-remove-on-unlike>
                        <i class="fa fa-heart-broken me-1"></i> Bỏ thích
                      </a>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Reminder to login -->
            <div class="col-12 mt-4">
              <div class="bg-light rounded p-3 text-center">
                <p class="mb-2">
                  Đăng nhập để lưu wishlist và không bị mất khi đóng trình duyệt
                </p>
                <a th:href="@{/login}" class="btn essence-btn"
                  >Đăng nhập ngay</a
                >
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </body>
</html>
